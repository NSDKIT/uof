%% =========================================================
%  viz_plot_actual_output_by_day.m  ―  特定日のPV実績出力の棒グラフ可視化
%  =========================================================
%
%  【役割】
%    指定した年のPV「実績」出力データから、特定の日（スクリプト内に
%    ハードコーディング）の最大PV出力を月ごとの棒グラフで可視化する。
%    天候が悪かった日や特異日の特定・確認に使用される。
%
%  【実行方法】
%    >> PV_real_form(2018)
%    >> PV_real_form(2019)
%
%  【パラメータ説明】
%    year0 : 対象年（例: 2018）
%
%  【入力ファイル（事前に同フォルダへ配置すること）】
%    ┌──────────────────────────┬──────────────────────────────────────┐
%    │ ファイル名               │ 内容                                 │
%    ├──────────────────────────┼──────────────────────────────────────┤
%    │ Pv_real_out_YYYY.mat     │ PV実績出力データ（変数: Pv_real_out）│
%    │ data_YYYY.mat            │ 日付配列（変数: data）               │
%    └──────────────────────────┴──────────────────────────────────────┘
%
%  【出力】
%    Figure (月番号): 各月に対応した12個のFigureウィンドウ
%      ・各サブプロットが1日に対応
%      ・棒グラフで当日の最大PV出力を表示
%
%  !! 【重要】可視化対象の日付がハードコーディングされている !!
%    変数 aa の行列（12行×9列）に、各月の対象日が直接記述されている。
%    「1」は対象外（ダミー値）として扱われる。
%    別の日を確認したい場合は、aa の値を手動で書き換えること。
%
%  【ハードコーディングされた対象日一覧（aa の内容）】
%    4月:  6, 16, 20日
%    5月:  3, 4, 7, 8, 23, 24, 25, 29日
%    6月:  3, 13, 25日
%    7月:  17, 26, 31日
%    8月:  2, 3, 4, 5, 8, 10, 11, 18, 26日
%    9月:  8, 9, 15日
%    10月: 9, 10, 31日
%    11月: 2, 5, 6, 12, 21, 23日
%    12月: 9, 16, 25日
%    1月:  11, 6, 10日
%    2月:  11, 24日
%    3月:  9, 12, 18, 19, 23, 25, 26日
% =========================================================

function viz_plot_actual_output_by_day(year0)

close all

%% --- データ読み込み（相対パス: input_data フォルダ） ---
load(fullfile('input_data', ['Pv_real_out_',num2str(year0),'.mat']))  % 変数: Pv_real_out → PV実績出力
load(fullfile('input_data', ['data_',num2str(year0),'.mat']))          % 変数: data → 日付配列

%% --- 月順序の定義（4月始まり） ---
M = [4, 5, 6, 7, 8, 9, 10, 11, 12, 1, 2, 3];

%% --- 可視化対象の日付（ハードコーディング）---
% 各行が1ヶ月分（M の順序に対応）、各列が対象日（「1」はダミー値）
aa = [6,  16, 20, 1,  1,  1,  1,  1,  1;   % 4月
      3,  4,  7,  8,  23, 24, 25, 29, 1;   % 5月
      3,  13, 25, 1,  1,  1,  1,  1,  1;   % 6月
      17, 26, 31, 1,  1,  1,  1,  1,  1;   % 7月
      2,  3,  4,  5,  8,  10, 11, 18, 26;  % 8月
      8,  9,  15, 1,  1,  1,  1,  1,  1;   % 9月
      9,  10, 31, 1,  1,  1,  1,  1,  1;   % 10月
      2,  5,  6,  12, 21, 23, 1,  1,  1;   % 11月
      9,  16, 25, 1,  1,  1,  1,  1,  1;   % 12月
      11, 6,  10, 1,  1,  1,  1,  1,  1;   % 1月
      11, 24, 1,  1,  1,  1,  1,  1,  1;   % 2月
      9,  12, 18, 19, 23, 25, 26, 1,  1];  % 3月

%% --- 月ごとに対象日の最大PV出力を棒グラフで描画 ---
for m = 1:12
    month = M(m);

    % 1〜3月は翌年扱い（4月始まり年度のため）
    if month < 4
        year = year0 + 1;
    else
        year = year0;
    end

    % 当月の日数を決定
    if month == 2
        if year == 2019; L_D = 28;
        elseif year == 2020; L_D = 29;
        end
    elseif month == 4 || month == 6 || month == 9 || month == 11
        L_D = 30;
    else
        L_D = 31;
    end

    % 当月の日付行を抽出
    a = data(find(data(:,2)==month), :);
    aaa = aa(m,:);  % 当月の対象日リスト

    % 対象日ごとに最大PV出力を棒グラフで描画
    for ii = 1:9
        day = aaa(ii);
        if day == 1 && ii > 1
            continue  % ダミー値（1）はスキップ
        end
        b = a(find(a(:,3)==day), :);  % 当日の行を取得
        figure(month)
        hold on
        subplot(5, 7, day)
        bar(max(Pv_real_out(b(1),:)))  % 当日の最大PV出力を棒グラフで表示
    end
end

end
