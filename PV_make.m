%% =========================================================
%  PV_make.m  ―  PV実績出力データの生成（導入量補正付き）
%  =========================================================
%
%  【役割】
%    実測PV出力データは過去の基準導入量（例: 819MW）で統一されていたため、
%    実際の各月の導入量（PV_capa）に合わせて補正した「実績出力」を生成する。
%    このスクリプトは予測誤差分析チェーンの【2番目のステップ】。
%
%  【実行方法】
%    >> PV_make(2018)   % 2018年度分を生成
%    >> PV_make(2019)   % 2019年度分を生成
%
%  【入力ファイル（事前に同フォルダへ配置すること）】
%    ┌──────────────────────────┬──────────────────────────────────────┐
%    │ ファイル名               │ 内容                                 │
%    ├──────────────────────────┼──────────────────────────────────────┤
%    │ data_YYYY.mat            │ 日付・時刻の基本配列                 │
%    │ PV_capa_YYYY.mat         │ 各月の実際のPV導入容量 [MW]          │
%    │ Pv_real_out_YYYY.mat     │ 補正前のPV出力実績値（1440分→30分間隔に間引き前）│
%    └──────────────────────────┴──────────────────────────────────────┘
%
%  【出力ファイル】
%    PV_YYYY.mat  ← 変数 data_all に補正済み実績出力 [MW] を格納
%
%  【次のステップ（このファイルを使う処理）】
%    → PV_forecast_error_make.m （予測誤差の計算）
%    → yosoku_seido.m / MAE.m   （精度評価）
%    → PV_compare.m             （予測と実績の比較可視化）
%
%  【内部処理の概要】
%    1. Pv_real_out の各行（1日分）を Mabiki 関数で1440分→30分間隔に間引く
%    2. 間引き結果（グローバル変数 DATA）を data_all に積み上げる
%
%  【依存する外部関数】
%    Mabiki(data, 入力点数, 出力点数)  ← このリポジトリ外の関数
%      → 実行前に MATLAB パスに追加されていることを確認すること
%
%  【注意事項】
%    - Mabiki 関数はグローバル変数 DATA に結果を書き込む仕様。
%    - コメントアウトされた旧処理（PV_capa による月別補正ループ）は
%      現在は使用されていないが、参考として残されている。
% =========================================================

function PV_make(year)

%% --- データ読み込み ---
load(['PV_capa_',num2str(year),'.mat'])      % 変数: PV_capa      → 各月の実際のPV導入容量 [MW]
load(['Pv_real_out_',num2str(year),'.mat'])  % 変数: Pv_real_out  → 補正前のPV実績出力（1440点/日）
load(['data_',num2str(year),'.mat'])         % 変数: data         → 日付配列

%% --- 1440分→30分間隔への間引き処理 ---
% Mabiki 関数で各日のデータを 1440点 から 30分間隔（48点）に変換する。
% 結果はグローバル変数 DATA に格納される。
data_all = [];
for i = 1:min(size(Pv_real_out))
    Mabiki(Pv_real_out(i,:), 1440, 30)  % 1440分データを30分間隔に間引き
    global DATA
    data_all = [data_all; DATA];         % 間引き結果を日ごとに積み上げ
end

%% --- 出力ファイルへ保存 ---
save(['PV_',num2str(year),'.mat'], 'data_all')
% → 保存先: PV_YYYY.mat（変数名: data_all、各行が1日分・48列）

end
